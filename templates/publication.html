{% extends "index.html" %} {% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                {% for category, message in messages %}
                    alert("{{ message }}");
                {% endfor %}
            });
        </script>
    {% endif %}
{% endwith %}

<!-- Kontejner pro seznam článků a detail -->
<div class="select-view">    
    <!-- Přepínač pro volbu zobrazení -->
    <div class="view-options">
        <button class="button-option" onclick="toggleView('list')">Seznamu</button>        
        <button class="button-option active" onclick="toggleView('both')">Seznam a detail</button>
        <button class="button-option" onclick="toggleView('detail')">Detail</button>
        <button class="button-option" onclick="toggleView('export')">Export</button>
        <button class="button-option" onclick="toggleView('export-bib')">Export BIB</button>

        &nbsp&nbsp&nbsp
        <button type="button" onclick="toggleFiltersDsiplay()">Zobrazit/Skrýt filtrování</button>  
    </div>
</div>

<div class="main-content-container">    


    <!-- Levá část: Filtraci a seznam článků -->    
    <div class="left-section">         
        <!-- Filtrační formulář -->     
        <form id="filter-form" class="formWidthMedium" style="display:none;">        
            <div class="filter-row"> 
                <div class="filter-group">                
                    <label for="filter_Casopis">Časopis:
                    </label>                
                    <select id="filter_Casopis" name="filter_Casopis">                    
                        <option value="">Vše
                        </option>                    {% for casopis in casopisy %}                         
                        <option value="{{ casopis.journal }}" {% if casopis.journal == request.args.get('filter_Casopis') %}selected{% endif %}>{{ casopis.journal }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>            
                <div class="filter-group">                
                    <label for="filter_RokVydani">Rok vydání:
                    </label>                
                    <select id="filter_RokVydani" name="filter_RokVydani">                    
                        <option value="">Vše
                        </option>                    {% for rok in roky_vydani %}                         
                        <option value="{{ rok.year_publication }}" {% if rok.year_publication == request.args.get('filter_RokVydani') %}selected{% endif %}>{{ rok.year_publication }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>     
                <div class="filter-group">                
                    <label for="filter_UsedInReview">Used in review:</label>                
                    <select id="filter_UsedInReview" name="filter_UsedInReview">    
                        <option value="">Vše</option>
                        {% for used in usedInReview %}                         
                        <option value="{{ used }}" {% if used == request.args.get('filter_UsedInReview') %}selected{% endif %}>{{ used }}</option>
                        {% endfor %}                                           
                    </select>            
                </div>    
            </div>        
            <div class="filter-row">            
                <div class="filter-group">                
                    <label for="filter_Kategorie">Kategorie:
                    </label>                
                    <select id="filter_Kategorie" name="filter_Kategorie">                    
                        <option value="">Vše
                        </option>                    {% for kat in kategorie %}                         
                        <option value="{{ kat.category }}" {% if kat.category == request.args.get('filter_Kategorie') %}selected{% endif %}>{{ kat.category }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>            
                <div class="filter-group">                
                    <label for="filter_Podkategorie">Podkategorie:
                    </label>                
                    <select id="filter_Podkategorie" name="filter_Podkategorie">                    
                        <option value="">Vše
                        </option>                    {% for podkat in podkategorie %}                         
                        <option value="{{ podkat.subcategory }}" {% if podkat.subcategory == request.args.get('filter_Podkategorie') %}selected{% endif %}>{{ podkat.subcategory }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>        
            </div>        
            <div class="filter-row">            
                <div class="filter-group">                
                    <label for="filter_TypSenzoru">Typ senzoru:
                    </label>                
                    <select id="filter_TypSenzoru" name="filter_TypSenzoru">                    
                        <option value="">Vše
                        </option>                    {% for typ in typy_senzoru %}                         
                        <option value="{{ typ.sensor_type }}" {% if typ.sensor_type == request.args.get('filter_TypSenzoru') %}selected{% endif %}>{{ typ.sensor_type }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>    
                
                <div class="filter-group">                
                    <label for="filter_PrincipSenzoru">Princip senzoru: 
                    </label>                
                    <select id="filter_PrincipSenzoru" name="filter_PrincipSenzoru">                    
                        <option value="">Vše
                        </option>                                   
                        {% for princip in principy_senzoru %}                         
                            <option value="{{ princip.sensor_principle }}" {% if princip.sensor_principle == request.args.get('filter_PrincipSenzoru') %}selected{% endif %}>{{ princip.sensor_principle }}</option>                    
                        {% endfor %}    
                                             
                                    
                    </select>            
                </div>        
                <div class="filter-group">                
                    <label for="filter_Velicina">Veličina:
                    </label>                
                    <select id="filter_Velicina" name="filter_Velicina">                    
                        <option value="">Vše                            
                        </option>                    
                        {% for value in veliciny %}     
                            <option value="{{ value.measured_value }}" {% if value.measured_value == request.args.get('filter_Velicina') %}selected{% endif %}>{{ value.measured_value }}</option>
                        {% endfor %}               
                    </select>            
                </div>                             
            </div>  
            <div class="filter-row">    
   
            </div>
            <div class="filter-row">
                <div class="filter-group">                
                    <label for="filter_ZpusobZapouzdreni">Zapouzdření:
                    </label>                
                    <select id="filter_ZpusobZapouzdreni" name="filter_ZpusobZapouzdreni">                    
                        <option value="">Vše</option>                    {% for zpusob in zpusoby_zapouzdreni %}                         
                        <option value="{{ zpusob.encapsulation }}" {% if zpusob.encapsulation == request.args.get('filter_ZpusobZapouzdreni') %}selected{% endif %}>{{ zpusob.encapsulation }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div>    
                <div class="filter-group">            
                    <label for="filter_ZpusobImplementace">Implementace:</label>                
                    <select id="filter_ZpusobImplementace" name="filter_ZpusobImplementace">                    
                        <option value="">Vše</option>                    {% for zpusob in zpusoby_implementace %}                         
                        <option value="{{ zpusob.implementation }}" {% if zpusob.implementation == request.args.get('filter_ZpusobImplementace') %}selected{% endif %}>{{ zpusob.implementation }}
                        </option>                    {% endfor %}                 
                    </select>            
                </div> 
            </div>   

            <div class="filter-row">            
            </div>

            <div class="filter-row">            
                <div class="filter-group">                
                    <label for="search_query">Hledat:</label>                
                    <input type="text" id="search_query" name="search_query" placeholder="Zadejte hledaný výraz..." value="{{ request.args.get('search_query', '') }}">            
                </div>            
                <div class="filter-group">                
                    <label for="search_option">Možnost:
                    </label>                
                    <select id="search_option" name="search_option">                    
                        <option value="any" {% if request.args.get('search_option') == 'any' %}selected{% endif %}>Alespoň jeden
                        </option>                    
                        <option value="all" {% if request.args.get('search_option') == 'all' %}selected{% endif %}>Všechny
                        </option>                
                    </select>            
                </div>        
            </div>   
            
            <div class="filter-row">            
                <div class="filter-group">                
                    <label for="sort_column_name">Sorting:</label>                
                    <select id="sort_column_name" name="sort_column_name"> 
                        {% for sort in sorting %}                         
                            <option value="{{ sort.column_name }}" {% if sort.column_name == request.args.get('sort_column_name') %}selected{% endif %}>
                                {{ sort.display_name }}
                            </option>
                        {% endfor %}  
                    </select>            
                </div> 

                <div class="filter-group">                
                    <label for="sort_order">Order:</label>                
                    <select id="sort_order" name="sort_order">                    
                        {% for sort in sorting_order %}                         
                            <option value="{{ sort.order }}" {% if sort.order == request.args.get('sort_order') %}selected{% endif %}>
                                {{ sort.display_name }}
                            </option>
                        {% endfor %} 
                    </select>            
                </div> 
            </div>

            <button type="button" onclick="applyFilters()">Filtrovat</button>                   


            <!-- Sekce pro volbu zobrazených sloupců -->
            <br>
            <div id="parameters" class="filter-group checkbox-container">


                <div class="checkbox-item">
                    <label for="col_NazevClanku">Název článku</label>
                    <input type="checkbox" id="col_NazevClanku" checked onchange="toggleColumn('NazevClanku')">
                </div>

                <div class="checkbox-item">
                    <label for="col_Casopis">Název časopisu</label>
                    <input type="checkbox" id="col_Casopis" onchange="toggleColumn('Casopis')">
                </div>

                <div class="checkbox-item">
                    <label for="col_RokVydani">Rok vydání</label>
                    <input type="checkbox" id="col_RokVydani" onchange="toggleColumn('RokVydani')">
                </div>

                <div class="checkbox-item">
                    <label for="col_TypSenzoru">Typ senzoru</label>
                    <input type="checkbox" id="col_TypSenzoru" checked onchange="toggleColumn('TypSenzoru')">
                </div>
                <div class="checkbox-item">
                    <label for="col_PrincipSenzoru">Princip senzoru</label>
                    <input type="checkbox" id="col_PrincipSenzoru" checked onchange="toggleColumn('PrincipSenzoru')">
                </div>

                <div class="checkbox-item">
                    <label for="col_KonstrukceSenzoru">Konstrukce senzoru</label>
                    <input type="checkbox" id="col_KonstrukceSenzoru" onchange="toggleColumn('KonstrukceSenzoru')">
                </div>
                <div class="checkbox-item">
                    <label for="col_TypOptickehoVlakna">Vlakno</label>
                    <input type="checkbox" id="col_TypOptickehoVlakna" onchange="toggleColumn('TypOptickehoVlakna')">
                </div>

                <div class="checkbox-item">
                    <label for="col_ZpusobZapouzdreni">Zapouzdreni</label>
                    <input type="checkbox" id="col_ZpusobZapouzdreni" onchange="toggleColumn('ZpusobZapouzdreni')">
                </div>
                <div class="checkbox-item">
                    <label for="col_ZpusobImplementace">Implementace</label>
                    <input type="checkbox" id="col_ZpusobImplementace" onchange="toggleColumn('ZpusobImplementace')">
                </div>

                <div class="checkbox-item">
                    <label for="col_Kategorie">Kategorie</label>
                    <input type="checkbox" id="col_Kategorie" checked onchange="toggleColumn('Kategorie')">
                </div>

                <div class="checkbox-item">
                    <label for="col_Podkategorie">Podkategorie</label>
                    <input type="checkbox" id="col_Podkategorie" checked onchange="toggleColumn('Podkategorie')">
                </div>

                <div class="checkbox-item">
                    <label for="col_MerenaVelicina">Veličina</label>
                    <input type="checkbox" id="col_MerenaVelicina" onchange="toggleColumn('MerenaVelicina')">
                </div>
                <div class="checkbox-item">
                    <label for="col_RozsahMereni">Rozsah měření</label>
                    <input type="checkbox" id="col_RozsahMereni"  onchange="toggleColumn('RozsahMereni')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Citlivost">Citlivost</label>
                    <input type="checkbox" id="col_Citlivost"  onchange="toggleColumn('Citlivost')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Presnost">Přesnost</label>
                    <input type="checkbox" id="col_Presnost"  onchange="toggleColumn('Presnost')">
                </div>

                <div class="checkbox-item">
                    <label for="col_FrekvencniRozsah">Frekvencni rozsah</label>
                    <input type="checkbox" id="col_FrekvencniRozsah"  onchange="toggleColumn('FrekvencniRozsah')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Vyhody">Výhody</label>
                    <input type="checkbox" id="col_Vyhody"  onchange="toggleColumn('Vyhody')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Nevyhody">Nevýhody</label>
                    <input type="checkbox" id="col_Nevyhody"  onchange="toggleColumn('Nevyhody')">
                </div>

                <div class="checkbox-item">
                    <label for="col_AplikaceStudie">Aplikace</label>
                    <input type="checkbox" id="col_AplikaceStudie"  onchange="toggleColumn('AplikaceStudie')">
                </div>
                <div class="checkbox-item">
                    <label for="col_KlicovePoznamky">Klíčové poznámky</label>
                    <input type="checkbox" id="col_KlicovePoznamky"  onchange="toggleColumn('KlicovePoznamky')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Poznamky">Poznámky</label>
                    <input type="checkbox" id="col_Poznamky"  onchange="toggleColumn('Poznamky')">
                </div>
                <div class="checkbox-item">
                    <label for="col_NazevPDF">PDF</label>
                    <input type="checkbox" id="col_NazevPDF"  onchange="toggleColumn('NazevPDF')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Obrazky">Obrazky</label>
                    <input type="checkbox" id="col_Obrazky"  onchange="toggleColumn('Obrazky')">
                </div>
                <div class="checkbox-item">
                    <label for="col_Stav">Stav</label>
                    <input type="checkbox" id="col_Stav"  onchange="toggleColumn('Stav')">
                </div>
                <div class="checkbox-item">
                    <label for="col_CitaceBib">CitaceBib</label>
                    <input type="checkbox" id="col_CitaceBib"  onchange="toggleColumn('CitaceBib')">
                </div>
                <div class="checkbox-item">
                    <label for="col_UsedInReview">Used in review</label>
                    <input type="checkbox" id="col_UsedInReview"  onchange="toggleColumn('UsedInReview')">
                </div>


            </div>
            
        </form> 


        <div><b>Počet zobrazených článků: </b> {{pocetClanku}}/{{pocetClankuCelkem.pocetClankuCelkem}} 
            <b>Akce: </b> 
            <button onclick="selectAllCheckboxesUseInReview()">Select all</button>
            <button onclick="deSelectAllCheckboxesUseInReview()">De-select all</button>
            <button type="button" onclick="toggleFiltersDsiplay()">Zobrazit/Skrýt filtrování</button>  
            

        </div>
        <!-- Seznam clanku  -->         
        <table border="1" class="article-table">            
            <tr>                
                <th class='publication_id'>    ID</th>  
                <th class='NazevClanku'>       Článek</th>                
                <th class='Casopis' style="display: none">           Časopis</th>                
                <th class='RokVydani' style="display: none">         Rok Vydání</th>                
                <th class='TypSenzoru'>        Typ sen.</th>                
                <th class='PrincipSenzoru'>    Princip sen.</th>                
                <th class='KonstrukceSenzoru' style="display: none"> Konstrukce senzoru</th> 
                <th class='TypOptickehoVlakna' style="display: none">Vlakno</th>                
                <th class='ZpusobZapouzdreni' style="display: none"> Zapouzdření</th>                
                <th class='ZpusobImplementace' style="display: none">Implementace</th>                                              
                <th class='Kategorie'>         Kategorie</th>                
                <th class='Podkategorie'>      Podkategorie</th>                 
                <th class='MerenaVelicina' style="display: none">    Veličina</th>  
                <!-- <th class='RozsahMereni'>      Rozsah mereni</th>  --> 
                <!-- <th class='Citlivost'>         Ciltivost</th>  --> 
                <!-- <th class='Presnost'>          Presnost</th>  --> 
                <!-- <th class='FrekvencniRozsah'>  FrekvencniRozsah</th>  --> 
                <!-- <th class='Vyhody'>            Vyhody</th>  --> 
                <!-- <th class='Nevyhody'>          Nevyhody</th>  --> 
                <!-- <th class='AplikaceStudie'>    Aplikace</th>  --> 
                <!-- <th class='KlicovePoznamky'>   Klicove poznamky</th>  --> 
                <!-- <th class='Poznamky'>          Poznamky</th>  --> 
                <!-- <th class='NazevPDF'>          NazevPDF</th>  --> 
                <!-- <th class='Obrazky'>           Obrazky</th>  --> 
                <th class='Stav' style="display: none">              Stav</th>  
                <th class='CitaceBib' style="display: none">         CitaceBib</th>  
                <th class='UsedInReview' style="display: none">      In review</th>
                
                <th class='akce'>Akce</th>             
            </tr>            

            {% for clanek in clanky %}   
                <tr id="article-{{clanek.publication_id}}" onclick="showArticleDetail({{ clanek.publication_id }})">   
                    <td class='publication_id'>    {{ clanek.publication_id }}</th>  
                    <td class='NazevClanku'>       {{ clanek.publication_name }}       </td>                
                    <td class='Casopis' style="display: none">           {{ clanek.journal }}           </td>                
                    <td class='RokVydani' style="display: none">         {{ clanek.year_publication }}         </td>     
                    <td class='TypSenzoru'>        {{ clanek.sensor_type }}        </td>                
                    <td class='PrincipSenzoru'>    {{ clanek.sensor_principle }}    </td>                
                    <td class='KonstrukceSenzoru' style="display: none"> {{ clanek.construction_principle }}    </td>  
                    <td class='TypOptickehoVlakna' style="display: none">{{ clanek.optical_fiber }}</td>                
                    <td class='ZpusobZapouzdreni' style="display: none"> {{ clanek.encapsulation }} </td>                
                    <td class='ZpusobImplementace' style="display: none">{{ clanek.implementation }}</td>                                              
                    <td class='Kategorie'>         {{ clanek.category }}         </td>                
                    <td class='Podkategorie'>      {{ clanek.subcategory }}      </td>                 
                    <td class='MerenaVelicina' style="display: none">    {{ clanek.measured_value }}    </td>  
                    <!--<td class='RozsahMereni'>      {{ clanek.measuring_range }}      </td>  --> 
                    <!--<td class='Citlivost'>         {{ clanek.sensitivity }}         </td>-->   
                    <!--<td class='Presnost'>          {{ clanek.accuracy }}          </td>  --> 
                    <!--<td class='FrekvencniRozsah'>  {{ clanek.frequency_range }}  </td>  --> 
                    <!--<td class='Vyhody'>            {{ clanek.advantages }}            </td> -->  
                    <!--<td class='Nevyhody'>          {{ clanek.disadvantages }}          </td> -->  
                    <!--<td class='AplikaceStudie'>    {{ clanek.application }}    </td>  --> 
                    <!--<td class='KlicovePoznamky'>   {{ clanek.key_knowledge }}   </td>  --> 
                    <!--<td class='Poznamky'>          {{ clanek.note }}          </td>  --> 
                    <!--<td class='NazevPDF'>          {{ clanek.pdf_name }}          </td> -->  
                    <!--<td class='Obrazky'>           {{ clanek.figure }}           </td>-->   
                    <td class='Stav' style="display: none">              {{ clanek.state }}              </td>
                    <td class='CitaceBib' style="display: none">         {{ clanek.citation }}         </td>               
                    <td class="UsedInReview"  style="display: none">
                        {% if clanek['used_in_review'] == "ANO" %}
                            <span class="UsedInReviewText"></span> <input type="checkbox" name="UsedInReview" value="{{ clanek['publication_id'] }}" checked> 
                        {% else %}
                            <span class="UsedInReviewText"></span> <input type="checkbox" name="UsedInReview" value="{{ clanek['publication_id'] }}"> 
                        {% endif %}
                    </td>
                    <td class='akce'>                                      
                        <a href="{{ url_for('publication.publication_edit', clanek_id=clanek.publication_id) }}" style="padding: 3px;"><img src="/reviewhub/static/icon-edit.svg" height="20px"></a>
                        <a href="javascript:void(0);" onclick="openDeleteModal('{{ url_for('publication.publication_delete', clanek_id=clanek['publication_id']) }}', '{{clanek['publication_name']}}')"><img src="/reviewhub/static/icon-delete.svg" height="20px"></a>
                        {% if clanek['used_in_review'] == 'ANO' %}
                            <input type="checkbox" name="UseInReview" value="{{ clanek['publication_id'] }}" checked> 
                        {% else %}
                            <input type="checkbox" name="UseInReview" value="{{ clanek['publication_id'] }}"> 
                        {% endif %}          
                    </td>            
                </tr>           
            {% endfor %}         
        </table> 

        <!-- Tlačítko pro export do textové oblasti -->
        <br>
    </div>    



    <!-- Pravá část: Detail článku -->    
    <div class="right-section">        
        <div id="article-detail" class="article-detail">  
            <div id="article-detail-views" class="article-detail-views">
                <button onclick="showTab(event, 'fulltext')">Full Text</button>
                <button onclick="showTab(event, 'informace')">Detailní informace</button>
                <button onclick="showTab(event, 'klicove_informace')">Klíčové informace</button>
            </div>
            <div id="article-detail-content" class="article-detail-content">  
            </div>
        </div>

        <div id="article-export-bib" class="article-export-bib" style="display:none">
            <form id="extract-form">
                <p>BIB reference</p>
                <textarea id="bib" rows="30" cols="100"></textarea>   
                <button type="button" class="style" onclick="exportBIB()">Export BIB</button> <br>   
            </form>
        </div>    

        <div id="article-export" class="article-export" style="display:none;">  
            <div id="article-export-left">
                <h3>Příprava dat pro GPT</h3>
                <form id="extract-form">
                    <div class="form-group">
                        <label for="RozsahGenerovanehoTextu">Doporuceny rozsah</label>
                        <input type="text" id="RozsahGenerovanehoTextu" name="RozsahGenerovanehoTextu"  value="3000">
                    </div>

                    <div class="form-group">
                        <label for="Instrukce">Instrukce</label>
                        <textarea id="Instrukce" rows="3" cols="100">Připrav text pro kapitolu TODO</textarea>
                    </div>


                    <!-- Textová oblast pro zobrazení výsledku JSON -->
                    <div class="filter-group checkbox-container">
                        <div class="checkbox-item">
                            <label for="col_extract_NazevClanku">Název článku</label>
                            <input type="checkbox" id="col_extract_NazevClanku" checked>
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_DOI">DOI</label>
                            <input type="checkbox" id="col_extract_DOI" checked>
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_RokPublikovani">Rok publikování</label>
                            <input type="checkbox" id="col_extract_RokPublikovani" checked>
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Kategorie">Kategorie</label>
                            <input type="checkbox" id="col_extract_Kategorie" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Podkategorie">Podkategorie</label>
                            <input type="checkbox" id="col_extract_Podkategorie" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_TypSenzoru">Typ senzoru</label>
                            <input type="checkbox" id="col_extract_TypSenzoru" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_TypSenzoru">Typ senzoru</label>
                            <input type="checkbox" id="col_extract_TypSenzoru" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_PrincipSenzoru">Princip senzoru</label>
                            <input type="checkbox" id="col_extract_PrincipSenzoru" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_KonstrukceSenzoru">Konstrukce senzoru</label>
                            <input type="checkbox" id="col_extract_KonstrukceSenzoru" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_TypOptickehoVlakna">Vlakno</label>
                            <input type="checkbox" id="col_extract_TypOptickehoVlakna"  >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_ZpusobZapouzdreni">Zapouzdreni</label>
                            <input type="checkbox" id="col_extract_ZpusobZapouzdreni" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_ZpusobImplementace">Implementace</label>
                            <input type="checkbox" id="col_extract_ZpusobImplementace" checked >
                        </div>

                        <div class="checkbox-item">
                            <label for="col_extract_MerenaVelicina">Veličina</label>
                            <input type="checkbox" id="col_extract_MerenaVelicina" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Vyhody">Výhody</label>
                            <input type="checkbox" id="col_extract_Vyhody" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Nevyhody">Nevýhody</label>
                            <input type="checkbox" id="col_extract_Nevyhody" >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_AplikaceStudie">Aplikace</label>
                            <input type="checkbox" id="col_extract_AplikaceStudie" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_KlicovePoznamky">Klíčové poznámky</label>
                            <input type="checkbox" id="col_extract_KlicovePoznamky" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Summary">Shrnutí</label>
                            <input type="checkbox" id="col_extract_Summary" checked >
                        </div>
                        <div class="checkbox-item">
                            <label for="col_extract_Poznamky">Poznámky</label>
                            <input type="checkbox" id="col_extract_Poznamky" >
                        </div>
                    </div>

                    <div class="checkbox-item">
                        <button type="button" class="style" onclick="exportToJSON()">Export to Text</button> <br>
                        <button type="button" onclick="copyToClipboard()">Kopírovat text do schránky</button>
                        <select id="gpt_model">
                            <option value="gpt-4">gpt-4</option>
                            <option value="gpt-4o">gpt-4o</option>
                            <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
                            <option value="o1-preview">o1-preview</option>
                            <option value="o1-mini">o1-mini</option>
                            <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>                  
                        </select>
                        
                        <button type="button" onclick="generateTextByGPT()">Vygenerovat text</button>
                        <button type="button" onclick="markAsUsedInReview()">Označit jako zpracované</button>
                    </div>

                    <div class="checkbox-item">
                        <label for="configAI">Konfigurace AI:</label><button type="button" onclick="downloadTextFromTextarea('configAI')">Stáhnout jako soubor</button>
                    </div>
                    <textarea id="configAI" rows="10" cols="60" placeholder="Sem bude vložena konfigurace AI ..."></textarea>
                    <div class="checkbox-item">
                        <label for="exportedText">Extrahovaný text:</label><button type="button" onclick="downloadTextFromTextarea('exportedText')">Stáhnout jako soubor</button>
                    </div>
                    <textarea id="exportedText" rows="20" cols="100">{{ json_data }}</textarea>
                    
                </form>
            </div>   
            <div id="article-export-right">
                <h3>Vygenerovaný text</h3>
                <div class="form-group">
                    <div class="form-item">
                        <label>Model</label>
                        <input type="text" id="usedModel"></textarea>
                    </div>
                    <div class="form-item">
                        <label>Input tokens</label>
                        <input type="text" id="inputTokens"></textarea>
                    </div>
                    <div class="form-item">
                        <label>Output tokens</label>
                        <input type="text" id="outputTokens"></textarea>
                    </div>
                </div>
                <textarea id="generatedText" rows="47" cols="100"></textarea>
            </div>
        </div>
    </div>
</div>
<!-- Modální okno pro editaci -->
<div id="edit-modal" class="modal" style="display:none;">    
    <div class="modal-content">        
        <span class="close" onclick="closeModal()">&times;
        </span>        <h2>Editace Článku</h2>        
        <form id="edit-form" action="{{ url_for('publication.publication_add') }}" method="post" enctype="multipart/form-data">            
            <!-- Obsah formuláře se stejnými poli jako při vytváření článku -->
            <div class="form-group">
                <label for="edit_nazev_clanku">Název článku:
                </label>
                <input type="text" id="edit_nazev_clanku" name="nazev_clanku" required>
            </div>            
            <!-- Přidej další pole zde... -->
            <button type="submit">Uložit změny
            </button>
        </form>
    </div>
</div>


<!-- Modalni okno pro potvrzeni smazani publikace -->
<div id="delete-modal">
    <div id="delete-modalContent">
        <h2>Potvrzení smazání</h2>
        <p>Opravdu chcete smazat tuto publikaci?</p> 
        <div id="delete-modalContent-name"></div>
        <div class="modal-buttons">
            <button onclick="confirmDeletion()">Smazat</button>
            <button onclick="closeModal()">Zrušit</button>
        </div>
    </div>
</div>

<!-- JavaScript pro načítání detailu článku -->
<script>

// Aktualizace UsedInReview v databazi pri zmene hodnoty
document.querySelectorAll('input[name="UsedInReview"]').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const articleId = this.value;  // Získá ID článku
        const status = this.checked ? 'ANO' : 'NE';  // Získá nový stav ANO/NE
        const usedInReviewText = this.parentNode.querySelector(".UsedInReviewText");

        // V pripade ze uzivatel odskrtne pouziti v review, odskrtne se i checkbox useInReview
        const useInReviewCheckbox = document.querySelector(`input[name="UseInReview"][value="${articleId}"]`);
        if(status === "NE") {
            console.log('checked=false')
            useInReviewCheckbox.checked = false;
        }

        // Volání samostatné funkce pro odeslání požadavku na server
        updateUsedInReview(articleId, status);
    });
});

document.addEventListener('DOMContentLoaded', () => {
    loadFormState();  // Načtení uloženého stavu

    // Zobrazeni panelu podle predchoziho stavu
    viewState = localStorage.getItem('viewState');
    toggleView(viewState);

    // Uložení stavu při změně checkboxů
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', saveFormState);
    });

    // Uložení stavu při změně selectů
    document.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', saveFormState);
    });
});

// Export dat do JSON struktury
const clankyData = {{ clanky|tojson }};

function showArticleDetail(clanekId) {

    // Zruší předchozí zvýraznění článku
    const previousHighlighted = document.querySelector('.highlighted');
    if (previousHighlighted) {
        previousHighlighted.classList.remove('highlighted');
    }

    // Najdi řádek tabulky s odpovídajícím ID článku a přidej mu třídu pro zvýraznění
    const selectedRow = document.getElementById(`article-${clanekId}`);
    if (selectedRow) {
        selectedRow.classList.add('highlighted');
    }


    const clankyData = {{ clanky|tojson }};
    const clanek = clankyData.find(publication => publication.publication_id == clanekId);  // Debug: porovnej clanekId s publication_id
    
    // Pokud clanek neexistuje, vypiš chybu a ukonči funkci
    if (!clanek) {
        console.error("Článek s tímto ID nebyl nalezen.");
        return;
    }


    // Aktualizuj obsah pravé sekce s informacemi o článku
    document.getElementById('article-detail-content').innerHTML = `

	<div class="tab-content" id="fulltext">
            ${clanek.pdf_name ? `<embed src="/reviewhub/static/uplouds/${clanek.pdf_name}" type="application/pdf" width="100%" height="1000px">` : '<p>Full text není dostupný.</p>'}
        </div>

        <div class="tab-content" id="informace"  style="display:none;"> 
            <h2>Detailní informace</h2>

            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Název</div> 
                <div class="publication-detail-param-value">${clanek.publication_name}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Abstrakt</div> 
                <div class="publication-detail-param-value">${clanek.abstract}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Časopis</div> 
                <div class="publication-detail-param-value"> ${clanek.journal}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Rok vydání</div> 
                <div class="publication-detail-param-value"> ${clanek.year_publication}</div>
            </div>
            <hr>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Kategorie</div> 
                <div class="publication-detail-param-value"> ${clanek.category}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Podkategorie</div> 
                <div class="publication-detail-param-value"> ${clanek.subcategory}</div>
            </div>
            <hr>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Typ senzoru</div> 
                <div class="publication-detail-param-value"> ${clanek.sensor_type}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Princip senzoru</div> 
                <div class="publication-detail-param-value"> ${clanek.sensor_principle}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Konstrukce senzoru</div> 
                <div class="publication-detail-param-value"> ${clanek.construction_principle}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Optické vlákn</div> 
                <div class="publication-detail-param-value"> ${clanek.optical_fiber}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Zapouzdření</div> 
                <div class="publication-detail-param-value"> ${clanek.encapsulation}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Implementace</div> 
                <div class="publication-detail-param-value"> ${clanek.implementation}</div>
            </div>
            <hr>            
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Měřená veličina</div> 
                <div class="publication-detail-param-value"> ${clanek.measured_value}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Rozsah měření</div> 
                <div class="publication-detail-param-value"> ${clanek.measuring_range}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Citlivost</div> 
                <div class="publication-detail-param-value"> ${clanek.sensitivity}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Přesnost</div> 
                <div class="publication-detail-param-value"> ${clanek.accuracy}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Frekvenční rozsah</div> 
                <div class="publication-detail-param-value"> ${clanek.frequency_range}</div>
            </div>            
            <hr>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Aplikace</div> 
                <div class="publication-detail-param-value"> ${clanek.application}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Klíčové poznatky</div> 
                <div class="publication-detail-param-value"> ${clanek.key_knowledge}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Shrnutí</div> 
                <div class="publication-detail-param-value"> ${clanek.summary}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Výhody</div> 
                <div class="publication-detail-param-value"> ${clanek.advantages}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Nevýhody</div> 
                <div class="publication-detail-param-value"> ${clanek.disadvantages}</div>
            </div>
            <hr>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Poznámky</div> 
                <div class="publication-detail-param-value"> ${clanek.note}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Obrázky</div> 
                <div class="publication-detail-param-value"> ${clanek.figure}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Autoři</div> 
                <div class="publication-detail-param-value"> ${clanek.authors}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">DOI</div> 
                <div class="publication-detail-param-value"> ${clanek.doi}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">CitaceBib</div> 
                <div class="publication-detail-param-value"> ${clanek.citation}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Stav</div> 
                <div class="publication-detail-param-value"> ${clanek.used_in_review}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Název PDF souboru</div> 
                <div class="publication-detail-param-value"> ${clanek.pdf_name}</div>
            </div>
        </div>
        
        <div class="tab-content" id="klicove_informace" style="display:none;">
            <h2>Klíčové informace</h2>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Abstrakt</div> 
                <div class="publication-detail-param-value"> ${clanek.abstract}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Aplikace</div> 
                <div class="publication-detail-param-value"> ${clanek.application}</div>
            </div>                    
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Klíčové poznatky</div> 
                <div class="publication-detail-param-value"> ${clanek.key_knowledge}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Shrnutí</div> 
                <div class="publication-detail-param-value"> ${clanek.summary}</div>
            </div>
            <div class="publication-detail-param-container">
                <div class="publication-detail-param-name">Poznámky</div> 
                <div class="publication-detail-param-value"> ${clanek.note}</div>
            </div>
        </div>
    `;

    // Zobraz první záložku
    showTab(event, 'fulltext');
}



function showTab(event, tabId) {
    // Skryj všechny tab-content divy
    var tabContents = document.getElementsByClassName('tab-content');
    for (var i = 0; i < tabContents.length; i++) {
        tabContents[i].style.display = 'none';
    }
    // Zobraz vybraný tab-content
    document.getElementById(tabId).style.display = 'block';
}

function editArticle(clanekId) {
    // Zde přidejte AJAX požadavek pro načtení dat článku a otevření formuláře
    fetch(`/get-article-detail/${clanekId}`)
        .then(response => response.json())
        .then(clanek => {
            // Naplňte formulář daty článku
            document.getElementById('pdf_soubor').value = clanek.nazev_pdf; // Naplňte další pole podle potřeby
            // Otevřete formulář pro editaci
            // Můžete použít modal nebo jiný způsob zobrazení
        })
        .catch(error => console.error('Chyba při načítání detailu článku:', error));
}

function applyFilters() {
    const filterForm = document.getElementById('filter-form');
    const formData = new FormData(filterForm);

    const queryParams = new URLSearchParams();

    for (const [key, value] of formData.entries()) {
        if (value) {  // Přidá jen neprázdné hodnoty
            queryParams.append(key, value);
        }
    }
    // ***
    // Načti filtraci
    window.location.href = `/reviewhub/publication?${queryParams.toString()}`;
    saveFormState()
    
    
}


// ZMena zobrazeni checkboxu pro volbu zobrazeni parametru v seznamu publikaci 
function toggleFiltersDsiplay() {
    const checkboxContainer = document.getElementById("filter-form");
    if (checkboxContainer.style.display == 'none') {
        checkboxContainer.style.display = '';
    } else {
        checkboxContainer.style.display ='none';
    }
}


function toggleColumn(columnClass) {

    // Získá všechny buňky (th a td) pro daný sloupec podle třídy
    const colElements = document.getElementsByClassName(columnClass);
    // ID checkboxu a checkbox samotny
    const checkboxId = 'col_' + columnClass;
    const checkbox = document.getElementById(checkboxId);


     // Pokud je checkbox zaškrtnutý, zobrazí sloupec, jinak ho skryje
     for (let i = 0; i < colElements.length; i++) {
        if (checkbox.checked) {
            colElements[i].style.display = '';  // Zobrazí sloupec
        } else {
            colElements[i].style.display = 'none';  // Skryje sloupec
        }
    }
    // Ulozit stav checkboxu
    saveFormState()

}

// Funkce, která nastaví viditelnost sloupců při načtení stránky
function initializeColumns() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    checkboxes.forEach(checkbox => {
        const columnClass = checkbox.id.replace('col_', '');  // Získání třídy sloupce z ID checkboxu
        toggleColumn(columnClass);  // Změní viditelnost sloupce na základě checkboxu
    });
}

function saveFormState() {
    const formState = {};

    // Uloží stav checkboxů
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        formState[checkbox.id] = checkbox.checked;
    });

    // Uloží stav selectů
    document.querySelectorAll('select').forEach(select => {
        formState[select.id] = select.value;
    });

    // Uloží stav do localStorage
    localStorage.setItem('formState', JSON.stringify(formState));
}


function loadFormState() {
    const formState = JSON.parse(localStorage.getItem('formState'));
    const ignoredNames  = ['UsedInReview', 'UseInReview'];

    if (formState) {
        // Obnovení stavu checkboxů
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            //if (formState.hasOwnProperty(checkbox.id)) {
            //    checkbox.checked = formState[checkbox.id];
            //}
            // Zkontroluj, zda checkbox obsahuje některé z ignorovaných name
            const hasIgnoredName = ignoredNames.some(ignoredName => checkbox.name === ignoredName);

            if (hasIgnoredName) {
                return;  // Přeskočí checkboxy s některým z ignorovaných name
            }

            if (formState.hasOwnProperty(checkbox.id)) {
                checkbox.checked = formState[checkbox.id];
            }
        });

        // Zobrazeni sloupcu v seznamu clanku
        initializeColumns();

        // Obnovení stavu selectů
        document.querySelectorAll('select').forEach(select => {
            if (formState.hasOwnProperty(select.id)) {
                select.value = formState[select.id];
            }
        });
    }
}



function toggleView(view) {
    const leftSection = document.querySelector('.left-section');
    const rightSection = document.querySelector('.right-section');
    const articleExport = document.querySelector('.article-export');
    const articleExportBIB = document.querySelector('.article-export-bib');
    const articleDetail = document.querySelector('.article-detail');

    const buttons = document.querySelectorAll('.button-option');
    buttons.forEach(button => {
        button.classList.remove('active');
    });

    if (view === "list") {
        // Zobrazit jen seznam (levou sekci)
        document.querySelector('.button-option:nth-child(1)').classList.add('active');
        leftSection.style.display = '';
        leftSection.style.width = '100%';
        rightSection.style.display = 'none';
        rightSection.style.display = 'none';
        viewState = 'list';
    } else if (view === 'detail') {
        // Zobrazit jen detail (pravou sekci)
        document.querySelector('.button-option:nth-child(3)').classList.add('active');
        leftSection.style.display = 'none';
        rightSection.style.display = 'none';
        rightSection.style.display = '';
        rightSection.style.width = '100%';
        articleDetail.style.display = '';
        articleExport.style.display = 'none';
        articleExportBIB.style.display = 'none';
        viewState = 'detail';
    } else if (view === 'both') {
        // Zobrazit obě sekce
        document.querySelector('.button-option:nth-child(2)').classList.add('active');
        leftSection.style.display = '';
        leftSection.style.width = '50%';
        rightSection.style.display = '';
        rightSection.style.width = '50%';
        articleDetail.style.display = ''
        articleExport.style.display = 'none'
        articleExportBIB.style.display = 'none'
        viewState = 'both';
    } else if (view === 'export') {
        // Zobrazit obě sekce
        document.querySelector('.button-option:nth-child(4)').classList.add('active');
        leftSection.style.display = 'none';
        leftSection.style.width = '';       
        rightSection.style.display = '';
        rightSection.style.width = '100%';
        articleDetail.style.display = 'none';
        articleExport.style.display = 'flex';
        articleExportBIB.style.display = 'none';
        viewState = 'export';
    } else if (view === 'export-bib') {
        // Zobrazit obě sekce
        document.querySelector('.button-option:nth-child(5)').classList.add('active');
        leftSection.style.display = '';
        leftSection.style.width = '60%';       
        rightSection.style.display = '';
        rightSection.style.width = '50%';
        articleDetail.style.display = 'none'
        articleExport.style.display = 'none'
        articleExportBIB.style.display = ''
        exportBIB();
        viewState = 'export-bib';
    }

    // Uloží stav do localStorage    
    localStorage.setItem('viewState', viewState);

}


function getCheckedValue(name) {
    return document.getElementById(name).checked
}



function exportToJSON() {

    // Získáme ID vybraných článků (checkboxy)
    const selectedIds = Array.from(document.querySelectorAll('input[name="UseInReview"]:checked')).map(cb => cb.value);
    const selectedArticles = clankyData.filter(publication => selectedIds.includes(String(publication.publication_id)));

    // Načteme hodnotu z inputu s id "RozsahGenerovanehoTextu"
    const rozsahTextu = document.getElementById('RozsahGenerovanehoTextu').value;
    const instrukce = document.getElementById('Instrukce').value;
    const projectStructure = {{ projekt.project_structure | tojson }};
    const projectName = {{ projekt.project_name | tojson }};
    
    // Vytvoření JSON struktury na základě zaškrtnutých checkboxů
    const articlesJson = selectedArticles.map(publication => {
        let article = { 'ID': publication.publication_id };
        article['DOI'] = publication.doi;

        if (getCheckedValue('col_extract_NazevClanku')) {
            article['NazevClanku'] = publication.publication_name;
        }
        if (getCheckedValue('col_extract_DOI')) {
            article['DOI'] = publication.doi;
        }
        if (getCheckedValue('col_extract_RokPublikovani')) {
            article['RokPublikovani'] = publication.year_publication;
        }
        if (getCheckedValue('col_extract_TypSenzoru')) {
            article['TypSenzoru'] = publication.sensor_type;
        }
        if (getCheckedValue('col_extract_PrincipSenzoru')) {
            article['PrincipSenzoru'] = publication.sensor_principle;
        }
        if (getCheckedValue('col_extract_KonstrukceSenzoru')) {
            article['KonstrukceSenzoru'] = publication.construction_principle;
        }
        if (getCheckedValue('col_extract_ZpusobZapouzdreni')) {
            article['Zapouzdreni'] = publication.encapsulation;
        }
        if (getCheckedValue('col_extract_TypOptickehoVlakna')) {
            article['OptickeVlakno'] = publication.optical_fiber;
        }
        if (getCheckedValue('col_extract_ZpusobImplementace')) {
            article['Implementace'] = publication.implementation;
        }
        if (getCheckedValue('col_extract_Kategorie')) {
            article['Kategorie'] = publication.category;
        }
        if (getCheckedValue('col_extract_Podkategorie')) {
            article['Podkategorie'] = publication.subcategory;
        }
        if (getCheckedValue('col_extract_MerenaVelicina')) {
            article['MerenaVelicina'] = publication.measured_value;
        }
        if (getCheckedValue('col_extract_Vyhody')) {
            article['Vyhody'] = publication.advantages;
        }
        if (getCheckedValue('col_extract_Nevyhody')) {
            article['Nevyhody'] = publication.disadvantages;
        }
        if (getCheckedValue('col_extract_AplikaceStudie')) {
            article['Aplikace'] = publication.application;
        }
        if (getCheckedValue('col_extract_KlicovePoznamky')) {
            article['KlicovePoznatky'] = publication.key_knowledge;
        }
        if (getCheckedValue('col_extract_Summary')) {
            article['Summary'] = publication.summary;
        }
        if (getCheckedValue('col_extract_Poznamky')) {
            article['Poznamky'] = publication.note;
        }

        return article;
    });

    // Nyní vytvoříme hlavní objekt, který bude obsahovat články a RozsahGenerovanehoTextu
    const exportJson = {
        'RozsahGenerovanehoTextu': rozsahTextu,  // Pro celý export
        'Instrukce': instrukce,  // Pro celý export
        'Struktura': parseSections(projectStructure), 
        'project_name': projectName,
        'Articles': articlesJson  // Seznam článků
    };
    
    // Zobrazení výsledku JSON v textové oblasti
    const jsonText = JSON.stringify(exportJson, null, 4);
    const textarea = document.getElementById('exportedText');
    textarea.style.display = 'block';  // Zobrazíme textové pole
    textarea.value = jsonText;  // Vložíme JSON do textového pole

    // Ziskani konfigurace pro GPT_B pro generovani textu
    //var socket = io();
    var socket = io({
        path: '/reviewhub/socket.io',
        transports: ['websocket', 'polling'],
        withCredentials: true
      });
    socket.emit('getConfigGPTB');

    // Poslouchání na zprávu od serveru
    socket.on("configGPTB", function(data) {
        document.getElementById("configAI").value = data;
    });
}

function markAsUsedInReview() {
    // Získáme ID vybraných článků (checkboxy)
    const selectedIds = Array.from(document.querySelectorAll('input[name="UseInReview"]:checked')).map(cb => cb.value);
    const selectedArticles = clankyData.filter(publication => selectedIds.includes(String(publication.publication_id)));

    // Aktualizace UsedInReview na strance a v databazi  pro exportované články
    selectedArticles.forEach(publication => {        
        // Aktualizace databaze
        updateUsedInReview(publication.publication_id, 'ANO');
        
        // Změníme checkboxu na ANO
        const usedInReviewCheckbox = document.querySelector(`input[name="UsedInReview"][value="${publication.publication_id}"]`);
        const usedInReviewText = usedInReviewCheckbox.parentNode.querySelector('.UsedInReviewText');
        usedInReviewCheckbox.checked = true;
        usedInReviewText.innerHTML = '';

    });
}

function copyToClipboard() {
    const textarea = document.getElementById("exportedText");
    textarea.select();
    textarea.setSelectionRange(0, 99999); // Pro mobilní zařízení

    navigator.clipboard.writeText(textarea.value)

}

function exportBIB() {
    // Získáme ID vybraných článků (checkboxy)
    const selectedIds = Array.from(document.querySelectorAll('input[name="UsedInReview"]:checked')).map(cb => cb.value);
    console.log(selectedIds)
    const selectedArticles = clankyData.filter(publication => selectedIds.includes(String(publication.publication_id)));
    console.log(selectedArticles)
    var bib = "";
    const articlesJson = selectedArticles.map(publication => {
        bib = bib + "\n" + publication.citation;
    })

    const textarea = document.getElementById('bib');
    textarea.value = bib;

}


// Načti stav checkboxů při načtení stránky
//window.onload = loadFormState;
//document.addEventListener('DOMContentLoaded', loadFormState);
// Přidání posluchače změny pro všechny selecty na stránce
function attachSelectListeners() {
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        select.addEventListener('change', saveFormState);
    });
}

function updateUsedInReview(articleId, status) {
    // Odeslání požadavku na server
    fetch('/reviewhub/publication_update_UsedInReview', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ articleId: articleId, usedInReview: status })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Úspěšně uloženo:', data);
    })
    .catch(error => console.error('Chyba při ukládání:', error));
}





function selectAllCheckboxesUseInReview() {
    // Vybereme všechny checkboxy s ID "UseInReview"
    const checkboxes = document.querySelectorAll('input[type="checkbox"][name="UseInReview"]');
    // Projdeme všechny vybrané checkboxy a nastavíme je na zaškrtnuté
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
}
function deSelectAllCheckboxesUseInReview() {
    // Vybereme všechny checkboxy s ID "UseInReview"
    const checkboxes = document.querySelectorAll('input[type="checkbox"][name="UseInReview"]');
    // Projdeme všechny vybrané checkboxy a nastavíme je na zaškrtnuté
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
}



</script>{% endblock %}
